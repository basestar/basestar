/*-
 * #%L
 * basestar-database-server
 * $Id:$
 * $HeadURL:$
 * %%
 * Copyright (C) 2020 basestar.io
 * %%
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * #L%
 */
{
  "Simple": {
    "properties": {
      "boolean": {
        "type": "boolean"
      },
      "number": {
        "type": "number"
      },
      "string": {
        "type": "string"
      },
      "array": {
        "type": {
          "array": {
            "type": "string"
          }
        }
      },
      "map": {
        "type": {
          "map": {
            "type": "string"
          }
        }
      }
    }
  },
  "Indexed": {
    "properties": {
      "value": {
        "type": "string"
      }
    },
    "indexes": {
      "index": {
        "partition": [
          "value"
        ]
      }
    }
  },
  "RefSource": {
    "properties": {
      "target": {
        "type": "RefTarget"
      }
    },
    "indexes": {
      "index": {
        "partition": [
          "target.id"
        ]
      }
    }
  },
  "RefTarget": {
    "properties": {
      "value": {
        "type": "string"
      },
      "target": {
        "type": "RefTarget"
      }
    },
    "links": {
      "sources": {
        "schema": "RefSource",
        "query": "target.id == this.id"
      }
    }
  },
  "SimplePerms": {
    "properties": {
      "owner": {
        "type": "User"
      }
    },
    "permissions": {
      "create": {
        "expression": "caller.id == after.owner.id"
      }
    }
  },
  "User": {
  },
  "MultiIndexed": {
    "@merge": "./blah",
    "properties": {
      "value": {
        "type": {
          "array": "string"
        },
        "required": true
      }
    },
    "indexes": {
      "index": {
        "over": {
          "v": "value"
        },
        "consistency": "ASYNC",
        "partition": [
          "v"
        ]
      }
    }
  },
  "Animal": {
    "properties": {
      "name": {
        "type": "string"
      },
      "class": {
        "type": "string"
      }
    },
    "indexes": {
      "name": {
        "partition": "name",
        "unique": true,
        "consistency": "ATOMIC"
      },
      "class": {
        "partition": "class"
      }
    }
  },
  "Cat": {
    "extend": "Animal",
    "properties": {
      "breed": {
        "type": "string"
      },
      "class": {
        "type": "string",
        "expression": "'Mammal'"
      }
    }
  },
  "Dog": {
    "extend": "Animal",
    "properties": {
      "breed": {
        "type": "string"
      },
      "class": {
        "type": "string",
        "expression": "'Mammal'"
      }
    }
  },
  "Kennel": {
    "properties": {
      "residents": {
        "type": {
          "array": "Animal"
        }
      }
    }
  }
}
