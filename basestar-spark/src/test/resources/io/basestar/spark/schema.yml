$version: LATEST

A:
  type: object
  properties:
    ref:
      type: B?
    arrayRef:
      type:
        array?: B
    mapRef:
      type:
        map?: B
    structRef:
      type: E?
  links:
    multi:
      schema: C
      expression: this.id == owner.id

B:
  type: object
  properties:
    key:
      type: D?
    value:
      type: integer?

C:
  type: object
  properties:
    owner:
      type: A?

D:
  type: object

E:
  type: struct
  properties:
    ref:
      type: B?

F:
  type: object
  properties:
    date:
      type: date?
    datetime:
      type: datetime?

AggView:
  type: view
  properties:
    agg:
      type: number
      expression: sum(value) + 2
    key:
      type: string?
      expression: key.id
    collect:
      type:
        array: B
      expression: collectArray(this)
  from: B
  group: key
  sort:
    - value
  expand:
    - agg
    - key
    - collect

AliasView:
  type: view
  group:
    - id
  properties:
    id:
      type: string
      expression: key.id
    count:
      type: integer
      expression: count()
  from: B

LinkingView:
  type: view
  properties:
    id: id
  from: B
  expand:
    - record
  links:
    record:
      schema: AliasView
      expression: this.id == id
      single: true
