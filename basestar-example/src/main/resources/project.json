{
  "types": {
    "Project": {
      "properties": {
        "name": {
          "type": "string",
          "required": true,
          "constraints": {
            "length": {
              "expression": "value.size() > 2"
            }
          }
        },
        "description": {
          "type": "string",
          "required": true
        },
        "creator": {
          "type": "User"
          "expression": "this ? this.creator : { \"id\": caller.id }"
        },
        "owner": {
          "type": {
            "ref": "User"
          }
        }
      },
      "links": {
        "tasks": {
          "type": "Task",
          "query": "project.id == this.id"
        },
        "teams": {
          "type": "ProjectTeam",
          "query": "project.id == $this.id"
        },
        "users": {
          "type": "ProjectUser",
          "query": "project.id == $this.id"
        }
      },
      "indexes": {
        "owner": {
          "partition": ["owner.id"]
        }
      },
      "permissions": {
        "read": {
          "expression": "owner.id == context.caller.id || id in [p.id for p of context.caller.projects] + context.caller.teams.flatMap(t -> [p.id for p of t.projects])",
          "expand": ["context.caller.projects", "context.caller.teams.projects"]
        },
        "create": {
          "expression": "$request.owner.id == $caller.id"
        },
        "update": {
          "expression": "$this.owner.id == $caller.id"
        }
      }
    },
    "ProjectTeam": {
      "properties": {
        "project": {
          "type": {
            "ref": "Project"
          }
        },
        "team": {
          "type": {
            "ref": "Team"
          }
        }
      },
      "links": {
        "tasks": {
          "type": "User",
          "query": "user.id == this.id"
        }
      }
    },
    "ProjectUser": {
      "properties": {
        "project": {
          "type": {
            "ref": "Project"
          }
        },
        "team": {
          "type": {
            "ref": "User"
          }
        }
      }
    }
  }
}